#!/bin/bash

set -e

function printStatus {
    if [ $? -eq 0 ]; then
        echo -e "\nSUITE SUCCESS"
    else
        echo -e "\nSUITE FAILURE"
    fi
}

trap printStatus EXIT

DIR=$(cd $(dirname $0) && pwd)

echo -e "\n Formatting packages..."
$DIR/go fmt cf/... testhelpers/... generic/... main/... glob/...

echo -e "\n Installing package dependencies..."
$DIR/go test -i cf/... generic/...

echo -e "\n Testing packages:"
$DIR/go test cf/... generic/... -parallel 4$@

echo -e "\n Vetting packages for potential issues..."
$DIR/go tool vet $DIR/../src/cf/.

echo -e "\n Running build script to confirm everything compiles..."
$DIR/build


